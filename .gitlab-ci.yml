image: maven:3.8.1-jdk-11-openj9

variables:
    MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"
    MAVEN_CLI_OPTS: "--batch-mode --errors"

cache:
    paths:
        - .m2/

stages:
    - build
    - test
    - check

sonar_analysis:
    stage: check
    script:
        - mvn verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar -DskipTests -Dsonar.projectKey=agl22_projetterinit  -DlastModGranularityMs=10000000

ter-build:
    stage: build
    script:
        - mvn $MAVEN_CLI_OPTS compile
    artifacts:
        paths:
            - target/

ter-test:
    stage: test
 #   dependencies:
 #       - ter-build
    script:
        - mvn $MAVEN_CLI_OPTS test  -DlastModGranularityMs=10000000
    artifacts:
        when: always
        reports:
            junit:
                - target/surefire-reports/TEST-*.xml
        paths:
            - target/site/jacoco/


#test_selenium:
#    stage : test2
#    artifacts:
#       paths:
#            - target/
#    before_script:
#        - apt-get update && apt-get upgrade --assume-yes
#        - apt-get install gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils --assume-yes
#        - apt-get install wget
#        - wget -nv -O ~/FirefoxSetup.tar.bz2 "https://download.mozilla.org/?product=firefox-latest&os=linux64"
#        - tar xjf ~/FirefoxSetup.tar.bz2 -C /opt/
#        - ln -s /opt/firefox/firefox /usr/lib/firefox
#        - export PATH=$PATH:/opt/firefox/
#    script:
#        - mvn verify


